@model IEnumerable<LibrarySystemBBU.Models.Book>

@{
    ViewData["Title"] = "Book List";
}

<link rel="stylesheet" href="~/font-awesome/css/all.min.css" />
<style>
    .card-3d {
        border: none;
        border-radius: 2rem;
        box-shadow: 0 10px 24px 0 rgba(0,0,0,0.11), 0 2px 4px 0 rgba(0,0,0,0.13);
        background: linear-gradient(135deg, #e0f2fe 0%, #f8fafc 100%);
        overflow: hidden;
        transition: transform .2s, box-shadow .2s;
    }

        .card-3d:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 16px 32px 0 rgba(0,126,255,0.17), 0 6px 12px 0 rgba(0,0,0,0.14);
        }

    .btn-glass {
        background: rgba(59,130,246,0.12);
        border: 1px solid #93c5fd;
        color: #2563eb;
        transition: all 0.2s;
        border-radius: 50px;
        font-weight: 600;
    }

        .btn-glass:hover {
            background: #60a5fa;
            color: #fff;
            border: 1px solid #2563eb;
        }

    .search-input {
        border-radius: 50px;
        box-shadow: 0 1px 3px 0 rgba(0,0,0,.08);
        padding-left: 2.3rem;
        font-size: 1rem;
    }

    .search-icon {
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #38bdf8;
    }

    .toggle-btn-group .btn.active {
        background: #2563eb !important;
        color: #fff !important;
    }

    .table thead th {
        vertical-align: middle;
    }
</style>

<div class="row my-4">
    <div class="col-12 text-center">
        <h2 class="fw-bold text-primary mb-1" style="letter-spacing:2px;">
            <i class="fa-solid fa-book fa-2x" style="color:#2563eb"></i> Book List
        </h2>
    </div>
</div>

<div class="row mb-3 align-items-center">
    <div class="col-md-4 col-sm-7 mx-auto">
        <div class="position-relative">
            <span class="position-absolute search-icon">
                <i class="fa-solid fa-magnifying-glass fa-lg"></i>
            </span>
            <input id="bookSearch" type="text" class="form-control search-input ps-5" placeholder="Search by title, author, category..." autocomplete="off" />
        </div>
    </div>
    <div class="col-6 col-md-4 text-end mt-2 mt-md-0">
        <div class="btn-group toggle-btn-group" role="group">
            <button id="btnCardView" class="btn btn-glass active" type="button" title="Card View" aria-label="Card View">
                <i class="fa-solid fa-grip"></i>
            </button>
            <button id="btnListView" class="btn btn-glass" type="button" title="List View" aria-label="List View">
                <i class="fa-solid fa-list"></i>
            </button>
        </div>
    </div>
    <div class="col-6 col-md-4 text-end mt-2 mt-md-0">
        <a asp-action="Create" class="btn btn-success btn-glass shadow px-4">
            <i class="fa-solid fa-plus"></i> Add Book
        </a>
    </div>
</div>

<!-- Card View -->
<div class="row g-4" id="bookCardList">
    @foreach (var item in Model)
    {
        <div class="col-12 col-md-6 col-lg-4 col-xl-3 book-card"
             data-title="@item.Title"
             data-author="@item.Author"
             data-category="@item.Category"
             data-isbn="@item.ISBN">
            <div class="card card-3d h-100">
                <div class="card-body px-4 py-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="badge bg-primary text-white px-3 py-2 rounded-pill" style="font-size:1.1em;">
                            <i class="fa-solid fa-barcode"></i> @item.ISBN
                        </span>
                        <span class="badge bg-info text-dark px-3 py-2 rounded-pill" style="font-size:1em;">
                            <i class="fa-solid fa-bookmark"></i> @item.Category
                        </span>
                    </div>
                    <h5 class="fw-bold mb-2 text-primary text-truncate">
                        <i class="fa-solid fa-book"></i> @item.Title
                    </h5>
                    <div class="mb-2 text-muted">
                        <i class="fa-solid fa-user-pen"></i> @item.Author
                    </div>
                    <div class="mb-2">
                        <span class="badge bg-success rounded-pill px-2">
                            <i class="fa-solid fa-layer-group"></i> Total: @item.TotalCopies
                        </span>
                        <span class="badge bg-warning text-dark rounded-pill px-2 ms-1">
                            <i class="fa-solid fa-box-open"></i> Available: @item.AvailableCopies
                        </span>
                    </div>
                    <hr />
                    <div class="d-flex justify-content-center gap-2 mt-1">
                        <a asp-action="Edit" asp-route-id="@item.BookId" class="btn btn-glass btn-sm" title="Edit">
                            <i class="fa-solid fa-pen-to-square fa-lg" style="color:#eab308"></i>
                        </a>
                        <a asp-action="Details" asp-route-id="@item.BookId" class="btn btn-glass btn-sm" title="Details">
                            <i class="fa-solid fa-circle-info fa-lg" style="color:#0ea5e9"></i>
                        </a>
                        <a asp-action="Delete" asp-route-id="@item.BookId" class="btn btn-glass btn-sm" title="Delete">
                            <i class="fa-solid fa-trash fa-lg" style="color:#ef4444"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<!-- Table/List View -->
<div id="bookTableList" class="d-none">
    <div class="table-responsive">
        <table class="table align-middle table-hover shadow-lg" style="border-radius:1.3rem;overflow:hidden;background:linear-gradient(135deg,#e0f2fe 0%,#f8fafc 100%);">
            <thead class="table-primary" style="border-top-left-radius:2rem;border-top-right-radius:2rem;font-size:1.07em;">
                <tr>
                    <th style="border-top-left-radius:1.2rem;">
                        <i class="fa-solid fa-book" style="color:#2563eb"></i> Title
                    </th>
                    <th><i class="fa-solid fa-user-pen" style="color:#0891b2"></i> Author</th>
                    <th><i class="fa-solid fa-barcode" style="color:#4b5563"></i> ISBN</th>
                    <th><i class="fa-solid fa-bookmark" style="color:#0ea5e9"></i> Category</th>
                    <th><i class="fa-solid fa-layer-group" style="color:#22c55e"></i> Total</th>
                    <th><i class="fa-solid fa-box-open" style="color:#f59e42"></i> Available</th>
                    <th class="text-center" style="border-top-right-radius:1.2rem;">Action</th>
                </tr>
            </thead>
            <tbody style="background:rgba(255,255,255,0.97);font-size:1.04em;">
                @foreach (var item in Model)
                {
                    <tr class="book-row"
                        data-title="@item.Title"
                        data-author="@item.Author"
                        data-category="@item.Category"
                        data-isbn="@item.ISBN"
                        style="box-shadow:0 2px 7px 0 rgba(52,144,220,0.03);border-radius:15px;">
                        <td class="fw-bold text-primary">@item.Title</td>
                        <td class="text-dark">@item.Author</td>
                        <td><span class="badge bg-primary text-white px-2"><i class="fa-solid fa-barcode"></i> @item.ISBN</span></td>
                        <td><span class="badge bg-info text-dark px-2"><i class="fa-solid fa-bookmark"></i> @item.Category</span></td>
                        <td>
                            <span class="badge bg-success rounded-pill px-2">
                                <i class="fa-solid fa-layer-group"></i> @item.TotalCopies
                            </span>
                        </td>
                        <td>
                            <span class="badge bg-warning text-dark rounded-pill px-2">
                                <i class="fa-solid fa-box-open"></i> @item.AvailableCopies
                            </span>
                        </td>
                        <td class="text-center">
                            <a asp-action="Edit" asp-route-id="@item.BookId" class="btn btn-glass btn-sm me-1" title="Edit">
                                <i class="fa-solid fa-pen-to-square" style="color:#eab308"></i>
                            </a>
                            <a asp-action="Details" asp-route-id="@item.BookId" class="btn btn-glass btn-sm me-1" title="Details">
                                <i class="fa-solid fa-circle-info" style="color:#0ea5e9"></i>
                            </a>
                            <a asp-action="Delete" asp-route-id="@item.BookId" class="btn btn-glass btn-sm" title="Delete">
                                <i class="fa-solid fa-trash" style="color:#ef4444"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script>
        // Live search for both view types
        document.getElementById('bookSearch').addEventListener('input', function () {
            let q = this.value.toLowerCase();
            document.querySelectorAll('.book-card').forEach(function (el) {
                let title = el.getAttribute('data-title')?.toLowerCase() || "";
                let author = el.getAttribute('data-author')?.toLowerCase() || "";
                let cat = el.getAttribute('data-category')?.toLowerCase() || "";
                let isbn = el.getAttribute('data-isbn')?.toLowerCase() || "";
                if (
                    title.includes(q) ||
                    author.includes(q) ||
                    cat.includes(q) ||
                    isbn.includes(q)
                ) {
                    el.style.display = "";
                } else {
                    el.style.display = "none";
                }
            });
            document.querySelectorAll('.book-row').forEach(function (el) {
                let title = el.getAttribute('data-title')?.toLowerCase() || "";
                let author = el.getAttribute('data-author')?.toLowerCase() || "";
                let cat = el.getAttribute('data-category')?.toLowerCase() || "";
                let isbn = el.getAttribute('data-isbn')?.toLowerCase() || "";
                if (
                    title.includes(q) ||
                    author.includes(q) ||
                    cat.includes(q) ||
                    isbn.includes(q)
                ) {
                    el.style.display = "";
                } else {
                    el.style.display = "none";
                }
            });
        });

        // Toggle View: Card vs List
        document.getElementById('btnCardView').addEventListener('click', function () {
            this.classList.add('active');
            document.getElementById('btnListView').classList.remove('active');
            document.getElementById('bookCardList').classList.remove('d-none');
            document.getElementById('bookTableList').classList.add('d-none');
        });
        document.getElementById('btnListView').addEventListener('click', function () {
            this.classList.add('active');
            document.getElementById('btnCardView').classList.remove('active');
            document.getElementById('bookCardList').classList.add('d-none');
            document.getElementById('bookTableList').classList.remove('d-none');
        });
    </script>
}
