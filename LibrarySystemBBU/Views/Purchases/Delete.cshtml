@model LibrarySystemBBU.Models.Purchase
@{
    ViewData["Title"] = "Delete Purchase";
}

<style>
    :root {
        --navy: #000080;
    }

    .text-navy {
        color: var(--navy) !important;
    }

    .bg-navy {
        background-color: var(--navy) !important;
    }

    .elev-card {
        border: 1px solid rgba(0,0,0,.06);
        border-radius: 1rem;
        background: #fff;
        box-shadow: 0 10px 24px rgba(0,0,128,.10);
    }

    .kv .key {
        min-width: 11rem;
        font-weight: 600;
        color: var(--navy);
    }

    .kv .val {
        word-break: break-word;
    }
</style>

<div class="container mt-4">
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
        <h2 class="mb-0 text-navy d-flex align-items-center gap-2">
            <i class="fa-regular fa-trash-can"></i> Delete Purchase
        </h2>
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="fa-solid fa-list me-1"></i> Back to List
        </a>
    </div>

    <div class="alert alert-warning mt-3 d-flex align-items-center" role="alert">
        <i class="fa-solid fa-triangle-exclamation me-2"></i>
        <div><strong>Are you sure?</strong> This action is permanent and cannot be undone.</div>
    </div>

    <div class="elev-card p-3 p-md-4 mt-3">
        <div class="row gy-3 kv">
            <div class="col-12 col-md-6 d-flex">
                <div class="key me-2"><i class="fa-regular fa-calendar-days me-1"></i>Purchase Date</div>
                <div class="val">@Model.PurchaseDate.ToString("yyyy-MM-dd")</div>
            </div>
            <div class="col-12 col-md-6 d-flex">
                <div class="key me-2"><i class="fa-solid fa-truck me-1"></i>Supplier</div>
                <div class="val"><span class="badge rounded-pill bg-navy">@Model.Supplier</span></div>
            </div>
            <div class="col-12 col-md-6 d-flex">
                <div class="key me-2"><i class="fa-solid fa-arrow-up-1-9 me-1"></i>Total Quantity</div>
                <div class="val">@Model.Quantity</div>
            </div>
            <div class="col-12 col-md-6 d-flex">
                <div class="key me-2"><i class="fa-solid fa-sack-dollar me-1"></i>Total Cost</div>
                <div class="val">@Model.Cost.ToString("N2")</div>
            </div>
        </div>
    </div>

    @* Optional: show line items if available *@
    @if (Model?.PurchaseDetails != null && Model.PurchaseDetails.Any())
    {
        <div class="table-responsive mt-3">
            <table class="table table-sm table-hover table-striped table-bordered align-middle mb-0">
                <thead class="table-light">
                    <tr class="text-navy">
                        <th><i class="fa-solid fa-book me-1"></i>Book</th>
                        <th class="text-end"><i class="fa-solid fa-arrow-up-1-9 me-1"></i>Quantity</th>
                        <th class="text-end"><i class="fa-solid fa-dollar-sign me-1"></i>Unit Price</th>
                        <th class="text-end"><i class="fa-solid fa-calculator me-1"></i>Line Total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var d in Model.PurchaseDetails.OrderBy(x => x.PurchaseDetailId))
                    {
                        <tr>
                            <td>@d.Book?.Title (@d.BookId)</td>
                            <td class="text-end">@d.Quantity</td>
                            <td class="text-end">@d.UnitPrice.ToString("N2")</td>
                            <td class="text-end">@d.LineTotal.ToString("N2")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }

    <form asp-action="Delete" method="post" id="deleteForm" class="elev-card mt-3">
        @Html.AntiForgeryToken()
        <div class="p-3 p-md-4">
            <input type="hidden" asp-for="PurchaseId" />

            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="confirmChk">
                <label class="form-check-label" for="confirmChk">
                    I understand this will permanently delete the purchase.
                </label>
            </div>

            <div class="mt-3 d-flex flex-wrap gap-2">
                <button type="button" class="btn btn-danger" id="openConfirm" disabled>
                    <i class="fa-regular fa-trash-can me-1"></i> Delete
                </button>
                <a asp-action="Index" class="btn btn-outline-secondary">
                    <i class="fa-solid fa-xmark me-1"></i> Cancel
                </a>
            </div>
        </div>
    </form>
</div>

@* Confirm modal *@
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title d-flex align-items-center gap-2" id="confirmModalLabel">
                    <i class="fa-regular fa-trash-can"></i> Confirm Deletion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                You are about to permanently delete this purchase. This cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-danger" form="deleteForm">
                    <i class="fa-regular fa-trash-can me-1"></i> Yes, delete it
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (() => {
            const chk = document.getElementById('confirmChk');
            const btn = document.getElementById('openConfirm');
            const modalEl = document.getElementById('confirmModal');

            chk?.addEventListener('change', () => {
                btn.disabled = !chk.checked;
            });

            btn?.addEventListener('click', () => {
                const modal = new bootstrap.Modal(modalEl);
                modal.show();
            });
        })();
    </script>
}
