@model IEnumerable<LibrarySystemBBU.Models.PurchaseDetail>

@{
    ViewData["Title"] = "Purchase Detail List";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
    .card-3d {
        border: none;
        border-radius: 1.5rem;
        box-shadow: 0 8px 24px 0 rgba(16,185,129,0.13), 0 2px 6px 0 rgba(0,0,0,0.11);
        background: linear-gradient(135deg, #f0fdfa 0%, #f8fafc 100%);
        overflow: hidden;
        transition: transform .2s, box-shadow .2s;
    }

        .card-3d:hover {
            transform: translateY(-5px) scale(1.015);
            box-shadow: 0 16px 32px 0 rgba(16,185,129,0.16), 0 6px 12px 0 rgba(0,0,0,0.15);
        }

    .btn-glass {
        background: rgba(16,185,129,0.12);
        border: 1px solid #6ee7b7;
        color: #059669;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.2s;
    }

        .btn-glass:hover {
            background: #34d399;
            color: #fff;
            border: 1px solid #059669;
        }

    .search-input {
        border-radius: 50px;
        box-shadow: 0 1px 3px 0 rgba(0,0,0,.07);
        padding-left: 2.3rem;
        font-size: 1rem;
    }

    .search-icon {
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #14b8a6;
    }

    .table th, .table td {
        vertical-align: middle !important;
    }

    .badge-soft {
        background: #e0f2fe;
        color: #2563eb;
        font-weight: 600;
        border-radius: 1.2rem;
        padding: 0.36em 1em;
    }
</style>

<div class="row my-4">
    <div class="col-12 text-center">
        <h2 class="fw-bold text-success mb-1" style="letter-spacing:1.5px;">
            <i class="fa-solid fa-file-invoice-dollar fa-2x" style="color:#059669"></i> Purchase Details
        </h2>
    </div>
</div>

<div class="row mb-3 align-items-center">
    <div class="col-md-4 col-sm-8 mx-auto mb-2 mb-md-0">
        <div class="position-relative">
            <span class="position-absolute search-icon">
                <i class="fa-solid fa-magnifying-glass"></i>
            </span>
            <input id="detailSearch" type="text" class="form-control search-input ps-5" placeholder="Search by supplier, book, author..." autocomplete="off" />
        </div>
    </div>
    <div class="col-md-8 text-end">
        <a asp-action="Create" class="btn btn-success btn-glass shadow px-4 mb-2 mb-md-0">
            <i class="fa-solid fa-plus"></i> Add New Detail
        </a>
    </div>
</div>

<div class="card card-3d mb-4">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table align-middle table-hover shadow-lg"
                   style="border-radius:1.2rem;overflow:hidden;background:linear-gradient(135deg,#f0fdfa 0%,#f8fafc 100%);">
                <thead class="table-success" style="font-size:1.07em;">
                    <tr>
                        <th><i class="fa-solid fa-box"></i> Quantity</th>
                        <th><i class="fa-solid fa-dollar-sign"></i> Unit Price</th>
                        <th><i class="fa-solid fa-money-bill-trend-up"></i> Line Total</th>
                        <th><i class="fa-solid fa-clock"></i> Created</th>
                        <th><i class="fa-solid fa-pen"></i> Modified</th>
                        <th><i class="fa-solid fa-user-tie"></i> Supplier</th>
                        <th><i class="fa-solid fa-book"></i> Book (Author)</th>
                        <th class="text-center"><i class="fa-solid fa-gears"></i> Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr class="detail-row"
                            data-quantity="@item.Quantity"
                            data-unitprice="@item.UnitPrice"
                            data-linetotal="@item.LineTotal"
                            data-supplier="@item.Purchase?.Supplier"
                            data-book="@item.Book?.Title"
                            data-author="@item.Book?.Author"
                            data-notes="@item.Purchase?.Notes">
                            <td>
                                <span class="badge-soft">@item.Quantity</span>
                            </td>
                            <td>
                                <span class="badge-soft">@String.Format("{0:C}", item.UnitPrice)</span>
                            </td>
                            <td>
                                <span class="badge-soft">@String.Format("{0:C}", item.LineTotal)</span>
                            </td>
                            <td>
                                <span class="badge-soft">@item.Created.ToString("yyyy-MM-dd")</span>
                            </td>
                            <td>
                                <span class="badge-soft">@item.Modified.ToString("yyyy-MM-dd")</span>
                            </td>
                            <td>
                                @item.Purchase?.Supplier ?? "-"
                            </td>
                            <td>
                                <span class="fw-bold">@item.Book?.Title</span>
                                <span class="text-muted small">(@item.Book?.Author)</span>
                            </td>
                            <td class="text-center">
                                <a asp-action="Edit" asp-route-id="@item.PurchaseDetailId" class="btn btn-glass btn-sm me-1" title="Edit">
                                    <i class="fa-solid fa-pen-to-square" style="color:#eab308"></i>
                                </a>
                                <a asp-action="Details" asp-route-id="@item.PurchaseDetailId" class="btn btn-glass btn-sm me-1" title="Details">
                                    <i class="fa-solid fa-circle-info" style="color:#0ea5e9"></i>
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.PurchaseDetailId" class="btn btn-glass btn-sm" title="Delete">
                                    <i class="fa-solid fa-trash" style="color:#ef4444"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Live search for all columns in Purchase Details
        document.getElementById('detailSearch').addEventListener('input', function () {
            let q = this.value.toLowerCase();
            document.querySelectorAll('.detail-row').forEach(function (el) {
                let data = Array.from(el.attributes)
                    .filter(attr => attr.name.startsWith('data-'))
                    .map(attr => attr.value.toLowerCase())
                    .join(' ');
                el.style.display = data.includes(q) ? "" : "none";
            });
        });
    </script>
}
